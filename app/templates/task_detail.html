{% extends 'base.html' %}

{% block title %}{{ task.title }} - НХТК{% endblock %}

{% block content %}
<div class="project-detail">
    <div class="actions-bar">
        <a href="{{ url_for('projects.project_detail', project_id=task.project_id) }}" class="btn back-btn">Назад к проекту</a>
    </div>

    <h2>{{ task.title }}</h2>

    <div class="info-grid">
        <div class="info-item">
            <strong>Статус</strong>
            <p><span class="status-badge {% if task.status == 'активна' %}status-active{% elif task.status == 'завершена' %}status-completed{% else %}status-paused{% endif %}">{{ task.status }}</span></p>
        </div>
        <div class="info-item">
            <strong>Исполнитель</strong>
            <p>{{ assignee.name if assignee else 'Не назначен' }}</p>
        </div>
        <div class="info-item">
            <strong>Дата создания</strong>
            <p>{{ task.created_at }}</p>
        </div>
        <div class="info-item">
            <strong>Дедлайн</strong>
            <p>{{ task.deadline }}</p>
        </div>
        <div class="info-item">
            <strong>Дата начала</strong>
            <p>{{ task.start_date or 'Не указана' }}</p>
        </div>
        <div class="info-item">
            <strong>Создатель</strong>
            <p>{{ creator.name if creator else 'Неизвестно' }}</p>
        </div>
    </div>

    <div class="project-description">
        <h3>Описание</h3>
        <p>{{ task.description or 'Нет описания' }}</p>
    </div>

    {% if task.files %}
    <div class="task-files-section">
        <h4>Прикрепленные файлы</h4>
        <div class="files-list">
            {% for file in task.files %}
            <div class="file-item">
                <span>{{ file.filename }}</span>
                <small>{{ file.uploaded_at }}</small>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    <div class="form-actions">
        <form action="{{ url_for('tasks.update_task_status', task_id=task.id) }}" method="POST" class="status-form">
            <select name="status" class="status-select">
                <option value="активна" {% if task.status == 'активна' %}selected{% endif %}>Активна</option>
                <option value="завершена" {% if task.status == 'завершена' %}selected{% endif %}>Завершена</option>
                <option value="отложена" {% if task.status == 'отложена' %}selected{% endif %}>Отложена</option>
            </select>
            <button type="submit" class="btn">Обновить статус</button>
        </form>
    </div>
</div>
{% endblock %}

{% extends 'base.html' %}

{% block title %}Личный кабинет - НХТК{% endblock %}

{% block content %}
<div class="profile-page">
    <h2>Личный кабинет</h2>
    
    <div class="profile-card">
        <div class="profile-avatar">{{ current_user.name[0] if current_user.name else 'U' }}</div>
        <div class="profile-info">
            <h3>{{ current_user.name }}</h3>
            <p class="profile-username">@{{ current_user.username }}</p>
            <span class="role-badge role-{{ current_user.role }}">
                {% if current_user.role == 'admin' %}Администратор
                {% elif current_user.role == 'manager' %}Руководитель проекта
                {% elif current_user.role == 'supervisor' %}Куратор
                {% else %}Исполнитель
                {% endif %}
            </span>
        </div>
    </div>

    <div class="profile-section">
        <h3>Ваш токен</h3>
        <div class="token-display">{{ current_user.token }}</div>
    </div>

    {% if current_user.role in ['admin', 'manager'] %}
    <div class="profile-section">
        <h3>Генерация токенов</h3>
        <form action="{{ url_for('generate_token_route') }}" method="POST" class="token-form">
            <div class="form-row">
                <div class="half-width">
                    <div class="form-group">
                        <label for="role">Роль для токена:</label>
                        <select name="role" id="role" required>
                            {% if current_user.role == 'admin' %}
                            <option value="admin">Администратор</option>
                            <option value="manager">Руководитель проекта</option>
                            {% endif %}
                            <option value="supervisor">Куратор</option>
                            <option value="worker">Исполнитель</option>
                        </select>
                    </div>
                </div>
                <div class="half-width">
                    <div class="form-group">
                        <label for="project_id">Проект (для исполнителя):</label>
                        <select name="project_id" id="project_id">
                            <option value="">-- Не выбрано --</option>
                            {% for project in projects %}
                            <option value="{{ project.id }}">{{ project.name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
            </div>
            <button type="submit">Сгенерировать токен</button>
        </form>
    </div>
    {% endif %}

    <div class="profile-section">
        <h3>Мои проекты</h3>
        {% if projects %}
        <div class="profile-projects-list">
            {% for project in projects %}
            <div class="profile-project-item">
                <span class="project-name">{{ project.name }}</span>
                <span class="status-badge {% if project.status == 'в работе' %}status-active{% elif project.status == 'завершен' %}status-completed{% else %}status-paused{% endif %}">{{ project.status }}</span>
                <a href="{{ url_for('projects.project_detail', project_id=project.id) }}" class="btn small-btn">Открыть</a>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <p class="no-data">Нет доступных проектов</p>
        {% endif %}
    </div>
</div>
{% endblock %}
